<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–¢—é—Ä—è–≥–∞: –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #f0c571;
            --dark-brown: #2d1a12;
            --panel-gradient: linear-gradient(to bottom, #4a2b1d, #2d1a12);
            --prison-orange: #d35400;
        }

        body {
            background: #1a0f0a url('https://www.transparenttextures.com/patterns/dark-brick-wall.png');
            color: #fff;
            font-family: 'Arial Narrow', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
        }

        /* –•–µ–¥–µ—Ä –≤ —Å—Ç–∏–ª–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ */
        .top-nav {
            display: flex;
            background: var(--panel-gradient);
            border-bottom: 2px solid #5e3a29;
            height: 40px;
            align-items: center;
            font-size: 12px;
            box-shadow: 0 2px 10px #000;
        }

        .top-nav div {
            flex: 1;
            text-align: center;
            border-right: 1px solid #5e3a29;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ —Å–ª–æ–µ–≤ —Ç–∞—Ç—É */
        .character-box {
            position: relative;
            width: 100%;
            height: 65vh;
            background: url('https://i.imgur.com/39A0vW3.png') no-repeat center bottom;
            background-size: contain;
            margin-top: 10px;
        }

        .tattoo-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .tattoo-layer.visible { opacity: 1; }

        /* –ò–∫–æ–Ω–∫–∏ —Å–ª–µ–≤–∞ */
        .side-menu {
            position: absolute;
            left: 10px;
            top: 60px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }

        .icon-btn {
            width: 42px;
            height: 42px;
            background: #3d2419;
            border: 2px solid #5e3a29;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: inset 0 0 8px #000;
        }

        .icon-btn.active { border-color: var(--gold); background: #5e3a29; }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã */
        .hp-container {
            position: absolute;
            top: 60px;
            right: 15px;
            width: 120px;
            text-align: right;
        }

        .bar-bg { background: #111; border: 1px solid #444; height: 10px; border-radius: 5px; overflow: hidden; margin-top: 4px; }
        .bar-fill { height: 100%; width: 100%; transition: 0.3s; }
        #hp-fill { background: linear-gradient(to right, #ff4444, #990000); }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–æ–π */
        .footer-action {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .btn-prison {
            background: linear-gradient(to bottom, #d35400, #a04000);
            border: 1px solid #f39c12;
            color: #fff;
            padding: 12px 30px;
            font-weight: bold;
            font-size: 18px;
            border-radius: 4px;
            text-shadow: 1px 1px #000;
            box-shadow: 0 4px 0 #5e2700;
        }

        .btn-prison:active { transform: translateY(2px); box-shadow: 0 2px 0 #5e2700; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { display: none; padding: 20px; height: 80vh; overflow-y: auto; background: rgba(0,0,0,0.8); }
        .screen.active { display: block; }

        /* –°–ø–∏—Å–∫–∏ */
        .list-item { background: #2d1a12; border: 1px solid #5e3a29; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; align-items: center; justify-content: space-between; }
    </style>
</head>
<body>

<div class="top-nav">
    <div style="color: var(--gold)">üë§ <span id="st-rank">–®–ù–´–†–¨</span></div>
    <div>‚ö° <span id="st-energy">30</span></div>
    <div style="color: #2ecc71">üö¨ <span id="st-cigs">0</span></div>
    <div style="color: var(--gold)">ü¶∑ <span id="st-teeth">0</span></div>
</div>

<div class="side-menu">
    <div class="icon-btn active" onclick="game.scr('main', this)">üè†</div>
    <div class="icon-btn" onclick="game.scr('ink', this)">üíâ</div>
    <div class="icon-btn" onclick="game.scr('top', this)">üèÜ</div>
</div>

<div id="scr-main" class="screen active" style="background: transparent; padding:0;">
    <div class="hp-container">
        <small id="b-name" style="color: var(--gold)">–ú–ê–ô–û–†</small>
        <div class="bar-bg"><div id="hp-fill" class="bar-fill"></div></div>
    </div>

    <div class="character-box">
        <div id="layer-stars" class="tattoo-layer" style="background-image: url('URL_STARS_PNG');"></div>
        <div id="layer-ring" class="tattoo-layer" style="background-image: url('URL_RING_PNG');"></div>
        <div id="layer-domes" class="tattoo-layer" style="background-image: url('URL_DOMES_PNG');"></div>
    </div>

    <div class="footer-action">
        <button class="btn-prison" onclick="game.hit()">–ß–Å –ù–ê?</button>
    </div>
</div>

<div id="scr-ink" class="screen">
    <h2 style="color: var(--gold)">–ö–û–õ–¨–©–ò–ö</h2>
    <div id="ink-list"></div>
</div>

<div id="scr-top" class="screen">
    <h2 style="color: var(--gold)">–ê–í–¢–û–†–ò–¢–ï–¢–´</h2>
    <div id="top-list"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

class PrisonGame {
    constructor() {
        this.cigs = 500;
        this.teeth = 0;
        this.myTattoos = [];
        this.boss = { name: "–ú–ê–ô–û–†", hp: 1000, max: 1000 };
        
        this.tattoos = [
            { id: 'stars', n: "–ó–≤–µ–∑–¥—ã", cost: 1000, dmg: 20 },
            { id: 'ring', n: "–ü–µ—Ä—Å—Ç–µ–Ω—å", cost: 5000, dmg: 50 },
            { id: 'domes', n: "–ö—É–ø–æ–ª–∞", cost: 20000, dmg: 150 }
        ];

        this.update();
    }

    scr(id, btn) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('scr-' + id).classList.add('active');
        if(btn) btn.classList.add('active');

        if(id === 'ink') this.renderInk();
        if(id === 'top') this.renderTop();
    }

    hit() {
        let dmg = 10 + (this.myTattoos.length * 20);
        this.boss.hp -= dmg;
        tg.HapticFeedback.impactOccurred('medium');

        if(this.boss.hp <= 0) {
            this.cigs += 200;
            this.boss.hp = this.boss.max;
            tg.showAlert("–ë–æ—Å—Å –ª–µ–≥! –ü–æ–ª—É—á–µ–Ω–æ 200 –ø–∞–ø–∏—Ä–æ—Å.");
        }
        this.update();
    }

    renderInk() {
        const list = document.getElementById('ink-list');
        list.innerHTML = this.tattoos.map(t => `
            <div class="list-item">
                <div><b>${t.n}</b><br><small>+${t.dmg} –∫ —É—Ä–æ–Ω—É</small></div>
                <button class="btn-prison" style="font-size:12px; padding:5px 10px" 
                    onclick="game.buyInk('${t.id}', ${t.cost})" 
                    ${this.myTattoos.includes(t.id) ? 'disabled' : ''}>
                    ${this.myTattoos.includes(t.id) ? '–ù–ê–ë–ò–¢–û' : t.cost + ' üö¨'}
                </button>
            </div>
        `).join('');
    }

    buyInk(id, cost) {
        if(this.cigs >= cost) {
            this.cigs -= cost;
            this.myTattoos.push(id);
            tg.HapticFeedback.notificationOccurred('success');
            this.renderInk();
            this.update();
        } else {
            tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–ø–∏—Ä–æ—Å!");
        }
    }

    renderTop() {
        const list = document.getElementById('top-list');
        const mockData = [
            {n: "–°–∏–ø–ª—ã–π", t: 150}, {n: "–í—ã", t: this.teeth}, {n: "–®—Ä–∞–º", t: 5}
        ].sort((a,b) => b.t - a.t);
        
        list.innerHTML = mockData.map((p, i) => `
            <div class="list-item">
                <span>${i+1}. ${p.n}</span>
                <span style="color: var(--gold)">${p.t} ü¶∑</span>
            </div>
        `).join('');
    }

    update() {
        document.getElementById('st-cigs').innerText = Math.floor(this.cigs);
        document.getElementById('st-teeth').innerText = this.teeth;
        document.getElementById('hp-fill').style.width = (this.boss.hp / this.boss.max * 100) + '%';
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ —Ç–∞—Ç—É –Ω–∞ —Ç–µ–ª–µ
        this.tattoos.forEach(t => {
            const layer = document.getElementById('layer-' + t.id);
            if(this.myTattoos.includes(t.id)) layer.classList.add('visible');
        });
    }
}

const game = new PrisonGame();
</script>
</body>
</html>
