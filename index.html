<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–¢—é—Ä—è–≥–∞: –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #f0c571;
            --dark-brown: #2d1a12;
            --prison-orange: #d35400;
            --rage-color: #ff0000;
        }

        body {
            background: #1a0f0a url('https://www.transparenttextures.com/patterns/dark-brick-wall.png');
            color: #fff; font-family: 'Arial Narrow', sans-serif;
            margin: 0; padding: 0; overflow: hidden; user-select: none;
        }

        /* –•–µ–¥–µ—Ä */
        .top-nav {
            display: flex; background: linear-gradient(to bottom, #4a2b1d, #2d1a12);
            border-bottom: 2px solid #5e3a29; height: 45px; align-items: center; font-size: 13px;
        }
        .top-nav div { flex: 1; text-align: center; border-right: 1px solid #5e3a29; }

        /* –ü–µ—Ä—Å–æ–Ω–∞–∂ */
        .character-box {
            position: relative; width: 100%; height: 60vh;
            background: url('https://i.imgur.com/39A0vW3.png') no-repeat center bottom;
            background-size: contain; transition: transform 0.05s;
        }
        .rage-mode .character-box { animation: shake 0.1s infinite; filter: sepia(1) saturate(5) hue-rotate(-50deg); }

        @keyframes shake {
            0% { transform: translate(2px, 1px) rotate(0deg); }
            50% { transform: translate(-1px, -2px) rotate(-1deg); }
            100% { transform: translate(1px, 2px) rotate(0deg); }
        }

        /* –¢–∞—Ç—É */
        .tattoo-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: contain; background-repeat: no-repeat; background-position: center bottom;
            opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
        .tattoo-layer.visible { opacity: 1; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —è—Ä–æ—Å—Ç–∏ */
        .rage-container {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            width: 200px; text-align: center;
        }
        .rage-bar-bg { background: #000; border: 1px solid #555; height: 8px; border-radius: 4px; overflow: hidden; }
        #rage-fill { width: 0%; height: 100%; background: var(--rage-color); transition: width 0.2s; box-shadow: 0 0 10px var(--rage-color); }

        /* –ë–æ—Å—Å –∏ –•–ü */
        .boss-info { position: absolute; top: 55px; right: 15px; width: 140px; text-align: right; }
        .hp-bar { background: #111; border: 1px solid #444; height: 12px; border-radius: 6px; overflow: hidden; }
        .hp-fill { height: 100%; width: 100%; background: linear-gradient(to right, #ff4444, #990000); transition: 0.2s; }

        /* –ö–Ω–æ–ø–∫–∞ */
        .footer { position: fixed; bottom: 20px; width: 100%; text-align: center; }
        .btn-hit {
            background: linear-gradient(to bottom, #d35400, #a04000);
            border: 1px solid #f39c12; color: #fff; padding: 15px 40px;
            font-weight: bold; font-size: 20px; border-radius: 5px;
            box-shadow: 0 4px 0 #5e2700;
        }
        .btn-hit:active { transform: translateY(2px); box-shadow: 0 2px 0 #5e2700; }
        .rage-active-btn { background: var(--rage-color) !important; border-color: #fff !important; }

        /* –ú–µ–Ω—é */
        .side-menu { position: absolute; left: 10px; top: 60px; display: flex; flex-direction: column; gap: 10px; }
        .icon-btn { width: 45px; height: 45px; background: #3d2419; border: 2px solid #5e3a29; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        
        .screen { display: none; position: fixed; top: 45px; bottom: 0; width: 100%; background: rgba(20,10,5,0.95); z-index: 100; padding: 20px; box-sizing: border-box; }
        .screen.active { display: block; }
        .list-item { background: #2d1a12; border: 1px solid #5e3a29; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body id="game-body">

<div class="top-nav">
    <div style="color: var(--gold)">üë§ <span id="st-rank">–®–ù–´–†–¨</span></div>
    <div style="color: #2ecc71">üö¨ <span id="st-cigs">0</span></div>
    <div style="color: var(--gold)">ü¶∑ <span id="st-teeth">0</span></div>
</div>

<div class="side-menu">
    <div class="icon-btn" onclick="game.scr('main')">üè†</div>
    <div class="icon-btn" onclick="game.scr('ink')">üíâ</div>
</div>

<div id="scr-main">
    <div class="boss-info">
        <b id="b-name" style="color: var(--gold); text-transform: uppercase;">–ö–ò–†–ü–ò–ß</b>
        <div class="hp-bar"><div id="hp-fill" class="hp-fill"></div></div>
        <small id="hp-num">1000/1000</small>
    </div>

    <div class="character-box" id="char-box">
        <div id="layer-stars" class="tattoo-layer" style="background-image: url('https://i.imgur.com/your_stars.png');"></div>
        <div id="layer-domes" class="tattoo-layer" style="background-image: url('https://i.imgur.com/your_domes.png');"></div>
    </div>

    <div class="rage-container">
        <small id="rage-text" style="color: #666;">–Ø–†–û–°–¢–¨</small>
        <div class="rage-bar-bg"><div id="rage-fill"></div></div>
    </div>

    <div class="footer">
        <button id="hit-btn" class="btn-hit" onclick="game.hit()">–ß–Å –ù–ê?</button>
    </div>
</div>

<div id="scr-ink" class="screen">
    <h2 style="color: var(--gold); border-bottom: 1px solid #5e3a29;">–°–ê–õ–û–ù "–£ –ö–û–õ–¨–©–ò–ö–ê"</h2>
    <div id="ink-list"></div>
    <button class="btn-hit" style="width:100%; margin-top:20px;" onclick="game.scr('main')">–ù–ê–ó–ê–î</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

class PrisonGame {
    constructor() {
        this.cigs = 1000;
        this.teeth = 0;
        this.myTattoos = [];
        
        // –ú–µ—Ö–∞–Ω–∏–∫–∞ —è—Ä–æ—Å—Ç–∏
        this.rage = 0;
        this.isRageMode = false;
        this.lastClick = 0;

        // –°–ø–∏—Å–æ–∫ –±–æ—Å—Å–æ–≤ –ø–æ —Å—Å—ã–ª–∫–µ
        this.bosses = [
            { n: "–ö–∏—Ä–ø–∏—á", hp: 1000, m: 1000, rew: 200 },
            { n: "–°–∏–∑—ã–π", hp: 10000, m: 10000, rew: 1000 },
            { n: "–ú–∞—Ö–Ω–æ", hp: 50000, m: 50000, rew: 5000 },
            { n: "–õ—é—Ç—ã–π", hp: 100000, m: 100000, rew: 15000 },
            { n: "–®–∞–π–±–∞", hp: 500000, m: 500000, rew: 50000 }
        ];
        this.bIdx = 0;

        this.tattoos = [
            { id: 'stars', n: "–í–æ—Ä–æ–≤—Å–∫–∏–µ –∑–≤–µ–∑–¥—ã", cost: 1500, dmg: 50 },
            { id: 'domes', n: "–ö—É–ø–æ–ª–∞ –Ω–∞ –≥—Ä—É–¥—å", cost: 10000, dmg: 200 }
        ];

        this.update();
        setInterval(() => this.decayRage(), 200);
    }

    scr(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        if(id !== 'main') document.getElementById('scr-' + id).classList.add('active');
        if(id === 'ink') this.renderInk();
    }

    hit() {
        if(this.isRageMode) tg.HapticFeedback.impactOccurred('heavy');
        else tg.HapticFeedback.impactOccurred('light');

        let baseDmg = 10;
        this.myTattoos.forEach(tid => {
            const t = this.tattoos.find(x => x.id === tid);
            if(t) baseDmg += t.dmg;
        });

        const multiplier = this.isRageMode ? 5 : 1;
        const totalDmg = baseDmg * multiplier;

        this.bosses[this.bIdx].hp -= totalDmg;
        
        // –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —è—Ä–æ—Å—Ç–∏
        if(!this.isRageMode) {
            this.rage += 5;
            if(this.rage >= 100) this.activateRage();
        }

        if(this.bosses[this.bIdx].hp <= 0) this.nextBoss();
        this.update();
    }

    activateRage() {
        this.isRageMode = true;
        this.rage = 100;
        document.getElementById('game-body').classList.add('rage-mode');
        document.getElementById('hit-btn').classList.add('rage-active-btn');
        document.getElementById('rage-text').innerText = "–Ø–†–û–°–¢–¨!!!";
        
        setTimeout(() => {
            this.isRageMode = false;
            this.rage = 0;
            document.getElementById('game-body').classList.remove('rage-mode');
            document.getElementById('hit-btn').classList.remove('rage-active-btn');
            document.getElementById('rage-text').innerText = "–Ø–†–û–°–¢–¨";
            this.update();
        }, 5000);
    }

    decayRage() {
        if(!this.isRageMode && this.rage > 0) {
            this.rage -= 1;
            this.update();
        }
    }

    nextBoss() {
        const b = this.bosses[this.bIdx];
        this.cigs += b.rew;
        tg.showAlert(`–ë–æ—Å—Å ${b.n} –ø–∞–ª! –¢–≤–æ–∏ –ø–∞–ø–∏—Ä–æ—Å—ã: ${this.cigs}`);
        
        if(this.bIdx < this.bosses.length - 1) this.bIdx++;
        else {
            this.bIdx = 0;
            tg.showAlert("–í—Å–µ –±–æ—Å—Å—ã –ø–æ–≤–∞–ª–µ–Ω—ã! –ò–¥–µ–º –Ω–∞ –≤—Ç–æ—Ä–æ–π –∫—Ä—É–≥.");
        }
        this.bosses[this.bIdx].hp = this.bosses[this.bIdx].m;
    }

    renderInk() {
        const list = document.getElementById('ink-list');
        list.innerHTML = this.tattoos.map(t => `
            <div class="list-item">
                <div><b>${t.n}</b><br><small>+${t.dmg} —É—Ä–æ–Ω–∞</small></div>
                <button class="btn-hit" style="font-size:14px; padding:10px;" 
                    onclick="game.buyInk('${t.id}', ${t.cost})"
                    ${this.myTattoos.includes(t.id) ? 'disabled' : ''}>
                    ${this.myTattoos.includes(t.id) ? '–ù–ê–ë–ò–¢–û' : t.cost + ' üö¨'}
                </button>
            </div>
        `).join('');
    }

    buyInk(id, cost) {
        if(this.cigs >= cost) {
            this.cigs -= cost;
            this.myTattoos.push(id);
            this.renderInk();
            this.update();
            tg.showAlert("–ö–æ–ª—å—â–∏–∫ —Å–¥–µ–ª–∞–ª –≤—Å—ë –≤ –ª—É—á—à–µ–º –≤–∏–¥–µ!");
        }
    }

    update() {
        const b = this.bosses[this.bIdx];
        document.getElementById('st-cigs').innerText = Math.floor(this.cigs);
        document.getElementById('b-name').innerText = b.n;
        document.getElementById('hp-num').innerText = `${Math.ceil(b.hp)} / ${b.m}`;
        document.getElementById('hp-fill').style.width = (b.hp / b.m * 100) + '%';
        document.getElementById('rage-fill').style.width = this.rage + '%';

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞—Ç—É
        this.myTattoos.forEach(tid => {
            const el = document.getElementById('layer-' + tid);
            if(el) el.classList.add('visible');
        });
    }
}

const game = new PrisonGame();
</script>
</body>
</html>
